---
# Получаем информацию о сервисах на удаленной машине
- name: CONSUL | Get service facts
  service_facts: {}
  tags: facts

# Получаем информацию об удаленной машине
- name: CONSUL | Getting facts
  setup:
    filter: ansible_*
  tags: facts

# Создаем группу
# Если:
## Группа не root
- name: CONSUL | Create user group
  group:
    name: "{{ consul_group }}"
  when:
    - consul_group != "root"
    - consul_manage_group|default(false)
  tags: os_group

# Создаем пользователя
# Если:
## Пользователь не root
- name: CONSUL | Create user
  user:
    name: "{{ consul_user }}"
    groups: "{{ consul_group }}"
    generate_ssh_key: "{{ consul_ssh_key }}"
    shell: "{{ consul_shell }}"
    system: "{{ consul_system }}"
    create_home: false
  when:
    - consul_user != "root"
    - consul_manage_user|default(false)
  tags: os_user
